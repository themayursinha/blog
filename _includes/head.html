<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, viewport-fit=cover">
  <script src="{{ "/js/theme-init.js" | prepend: site.baseurl | replace: '//', '/' }}"></script>

  {% assign seo_title = page["meta-title"] | default: page.title | default: site.title %}
  {% assign seo_raw_description = page["meta-description"] | default: page.description | default: page.subtitle %}
  {% if seo_raw_description %}
    {% assign seo_description_plain = seo_raw_description | strip_html | strip_newlines | strip %}
  {% elsif page.collection == "posts" %}
    {% if page.excerpt %}
      {% assign seo_description_plain = page.excerpt | strip_html | strip_newlines | truncate: 160 | strip %}
    {% elsif page.content %}
      {% assign seo_description_plain = page.content | strip_html | strip_newlines | truncate: 160 | strip %}
    {% else %}
      {% assign seo_description_plain = site.description | strip_html | strip_newlines | strip %}
    {% endif %}
  {% else %}
    {% assign seo_description_plain = site.description | strip_html | strip_newlines | strip %}
  {% endif %}

  {% if page.id %}
    {% assign canonical_url = page.url | absolute_url %}
  {% else %}
    {% assign canonical_url = page.url | remove: '/index.html' | remove: '.html' | absolute_url %}
  {% endif %}

  {% assign twitter_handle = site.author.twitter | default: site["social-network-links"].twitter %}
  {% if twitter_handle %}
    {% assign twitter_handle = twitter_handle | remove: "@" %}
  {% endif %}

  {% if page.share-img %}
    {% assign seo_image = page.share-img | absolute_url %}
  {% elsif page.image %}
    {% assign seo_image = page.image | absolute_url %}
  {% elsif site.avatar %}
    {% assign seo_image = site.avatar | absolute_url %}
  {% endif %}

  <title>{% if page.use-site-title %}{{ site.title }} {{ site.title-separator }} {{ site.description }}{% elsif page.title %}{{ page.title }}{% else %}{{ site.title }}{% endif %}</title>

  <meta name="author" content="{{ site.author.name }}" />
  <meta name="description" content="{{ seo_description_plain | xml_escape }}">
  {% if page.noindex or page.sitemap == false %}
  <meta name="robots" content="noindex, nofollow">
  {% else %}
  <meta name="robots" content="index, follow, max-image-preview:large">
  {% endif %}

  <link rel="canonical" href="{{ canonical_url }}" />
  <link rel="alternate" type="application/rss+xml" title="{{ site.title }} {{ site.title-separator }} {{ site.description }}" href="{{ site.baseurl }}/feed.xml" />

  {% include gtag.html %}
  {% include gtm_head.html %}
  {% include google_analytics.html %}

  {% if layout.common-ext-css %}
    {% for css in layout.common-ext-css %}
      {% include ext-css.html css=css %}
    {% endfor %}
  {% endif %}

  {% if layout.common-css %}
    {% for css in layout.common-css %}
      <link rel="stylesheet" href="{{ css | prepend: site.baseurl | replace: '//', '/' }}" />
    {% endfor %}
  {% endif %}

  {% if layout.common-googlefonts %}
    {% for font in layout.common-googlefonts %}
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family={{ font }}" />
    {% endfor %}
  {% endif %}

  {% if page.ext-css %}
    {% for css in page.ext-css %}
      <link rel="stylesheet" href="{{ css | prepend: site.baseurl | replace: '//', '/' }}" />
    {% endfor %}
  {% endif %}

  {% if page.css %}
    {% for css in page.css %}
      <link rel="stylesheet" href="{{ css | prepend: site.baseurl | replace: '//', '/' }}" />
    {% endfor %}
  {% endif %}

  {% if page.googlefonts %}
    {% for font in page.googlefonts %}
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family={{ font }}" />
    {% endfor %}
  {% endif %}

  <!-- Facebook OpenGraph tags -->
  {% if site.fb_app_id %}
  <meta property="fb:app_id" content="{{ site.fb_app_id }}" />
  {% endif %}

  <meta property="og:title" content="{{ seo_title | xml_escape }}" />
  <meta property="og:description" content="{{ seo_description_plain | xml_escape }}">
  {% if page.date %}
  <meta property="og:type" content="article" />
  {% else %}
  <meta property="og:type" content="website" />
  {% endif %}
  <meta property="og:url" content="{{ canonical_url }}" />

  {% if seo_image %}
  <meta property="og:image" content="{{ seo_image }}" />
  {% endif %}

  {% if page.date %}
  <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}" />
  <meta property="article:author" content="{{ site.author.name | xml_escape }}" />
    {% if page.tags and page.tags.size > 0 %}
      {% for tag in page.tags %}
  <meta property="article:tag" content="{{ tag | xml_escape }}" />
      {% endfor %}
    {% endif %}
  {% endif %}

  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="{% if seo_image %}summary_large_image{% else %}summary{% endif %}" />
  {% if twitter_handle %}
  <meta name="twitter:site" content="@{{ twitter_handle }}" />
  <meta name="twitter:creator" content="@{{ twitter_handle }}" />
  {% endif %}
  <meta name="twitter:title" content="{{ seo_title | xml_escape }}" />
  <meta name="twitter:description" content="{{ seo_description_plain | xml_escape }}">
  {% if seo_image %}
  <meta name="twitter:image" content="{{ seo_image }}" />
  {% endif %}

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "url": {{ site.url | jsonify }},
    "name": {{ site.title | jsonify }},
    "description": {{ site.description | jsonify }},
    "publisher": {
      "@type": "Person",
      "name": {{ site.author.name | jsonify }}
    }
  }
  </script>

  {% if page.date %}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": {{ seo_title | jsonify }},
    "description": {{ seo_description_plain | jsonify }},
    "datePublished": "{{ page.date | date_to_xmlschema }}",
    "dateModified": "{{ page.last_modified_at | default: page.date | date_to_xmlschema }}",
    "author": {
      "@type": "Person",
      "name": {{ site.author.name | jsonify }}
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "{{ canonical_url }}"
    }{% if seo_image %},
    "image": "{{ seo_image }}"{% endif %}{% if page.tags and page.tags.size > 0 %},
    "keywords": {{ page.tags | jsonify }}{% endif %}
  }
  </script>
  {% endif %}

  {% if site.matomo %}
  {% include matomo.html %}
  {% endif %}

  {% if page.comments and site.staticman.repository and site.staticman.branch %}
  <!-- Staticman -->
  <link rel="stylesheet" href="{{ "/css/staticman.css" | prepend: site.baseurl }}" />
  {% endif %}

  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha384-Wuix6BuhrWbjDBs24bXrjf4ZQ5aFeFWBuKkFekO2t8xFU0iNaLQfp2K6/1Nxveei" crossorigin="anonymous"></script>

  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">
</head>
